<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">

<head th:include="fragments/fragments :: head">
</head>
<style>
    #progress {
        width: 100%;
        background-color: grey;
    }

    #bar {
        width: 1%;
        height: 30px;
        background-color: green;
    }
</style>
<body class=" bg-light">

<!--<aside th:if="${param.}" class="alert alert-success" role="alert">-->
    <!--SMS has been sent!-->
<!--</aside>-->

<nav th:replace="fragments/fragments :: navbar"></nav>

<header th:replace=" fragments/fragments :: header"></header>
<h3 class="container mt-5 mb-5">Look at this booking details, <span th:text="${#authentication.principal.first}"/>!</h3>

<main class="container row mx-auto">
    <div class="border border-warning rounded col-12">
        <article class="m-4">
            <h3>Service Details:</h3>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th scope="col">Service Date</th>
                    <th scope="col">Vehicle</th>
                    <th scope="col">Service Type</th>
                    <th scope="col">Advisor</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="booking : ${bookings}">
                    <td th:text="${booking.date}"/>
                    <td th:text="${booking.vehicle.make + ' ' + booking.vehicle.model}"/>
                    <!--uncomment when database is filled-->
                    <td th:text="${booking.service_type.description}"/>
                    <td th:text="${booking.advisor.first}"/>
                </tr>
                </tbody>
            </table>
        </article>
        <hr class="hr-4 mx-4"/>
        <article class="m-4">
            <h3>Service status:</h3>
            <h4 th:text="${status}"/>
            <div class="progress" style="height: 50px;">
                <div class="progress-bar" th:style="'width: ' + ${width} + '%'" th:classappend="${color}"
                     role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </article>


        <article class="text-center mb-5" th:if="${bookings.status.id == 10}" sec:authorize="hasAuthority('ADVISOR')">
            <h3>Vehicle service has been completed!</h3>
            <form>
                <label for="send">Tell the customer that the car is ready to pick up!</label>
                <br/>
                <a href="/send" class="btn btn-success btn-lg active" role="button" aria-pressed="true" id="send">Send
                    SMS!</a>
            </form>
        </article>
        

    </div>
</main>

<footer th:replace="fragments/fragments :: footer"></footer>
<script>
    function move() {
        var elem = document.getElementById("bar");
        var width = 1;
        var id = setInterval(frame, 10);

        function frame() {
            if (width >= 100) {
                clearInterval(id);
            } else {
                width++;
                elem.style.width = width + '%';
            }
        }
    }

</script>
</body>
</html>